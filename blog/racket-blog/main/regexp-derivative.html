<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Matching Regular Expressions by Computing Their Derivatives</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Quasar<span class="mywbr"> &nbsp;</span>Bright Blog</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="composable-promises.html" class="tocviewlink" data-pltdoc="x">Composable Promises:<span class="mywbr"> &nbsp;</span> Adding Laziness to a Strict Language and Collapsing Indirection</a></td></tr><tr><td align="right"></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Matching Regular Expressions by Computing Their Derivatives</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Matching Regular Expressions by Computing Their Derivatives</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.The_.Derivative_of_a_.Regular_.Expression_%29" class="tocviewlink" data-pltdoc="x">The Derivative of a Regular Expression?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Putting_it_.All_.Together%29" class="tocviewlink" data-pltdoc="x">Putting it All Together</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.The_.Derivative_of_a_.Regular_.Expression_%29" class="tocsubseclink" data-pltdoc="x">The Derivative of a Regular Expression?</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.Detour__.A_.Simplifier%29" class="tocsubseclink" data-pltdoc="x">Detour:<span class="mywbr"> &nbsp;</span> A Simplifier</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Putting_it_.All_.Together%29" class="tocsubseclink" data-pltdoc="x">Putting it All Together</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.6</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="composable-promises.html" title="backward to &quot;Composable Promises: Adding Laziness to a Strict Language and Collapsing Indirection&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;QuasarBright Blog&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h3><a name="(part._regexp-derivative)"></a>Matching Regular Expressions by Computing Their Derivatives</h3><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Mike Delmonaco</p></span></div><p>Regular expressions allow us to describe patterns in text. They are very useful and show up all over the place in programming,
but matching regular expressions can be difficult. One well-known technique for matching regular expressions is converting the regular
expression to a finite state machine. This is pretty elegant, but can get complicated and messy.</p><p>An alternative technique, which is the subject of this blog post, involves something called a Brzozowski derivative. This technique can be
used to compute the derivative of a generalized regular expression.</p><h4>1<tt>&nbsp;</tt><a name="(part._.The_.Derivative_of_a_.Regular_.Expression_)"></a>The Derivative of a Regular Expression?</h4><p><div class="SIntrapara">The derivative of a regular expression <span class="RktSym">re</span> with respect to a character (or string) <span class="RktSym">c</span> is another regular expression which matches strings that,
when appended to <span class="RktSym">c</span>, are matches of <span class="RktSym">re</span>. Here are a few examples:
</div><div class="SIntrapara"><ul><li><p>The derivative of <span class="RktVal">#rx"abc"</span> with respect to <span class="RktVal">#\a</span> is <span class="RktVal">#rx"bc"</span></p></li><li><p>The derivative of <span class="RktVal">#rx"(ab)|(xy)"</span> with respect to <span class="RktVal">#\a</span> is <span class="RktVal">#rx"b"</span>. The second alternative is eliminated</p></li><li><p>The derivative of <span class="RktVal">#rx"(abc)*"</span> with respect to <span class="RktVal">#\a</span> is <span class="RktVal">#rx"bc(abc)*"</span></p></li><li><p>The derivative of <span class="RktVal">#rx"b"</span> with respect to <span class="RktVal">#\a</span> is a regular expression that has no matches ever.</p></li></ul></div></p><p>We take the derivative of a regular expression with respect to a string by repeatedly taking the derivative of the regular expression with respect to each character.</p><p>That&rsquo;s the idea. If the derivative of the regular expression with respect to the target string is a regular expression which matches the empty string, we have a match.</p><p>We will represent regular expressions with racket datums:</p><p><table cellspacing="0" cellpadding="0"><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rx</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktSym">character</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">'</span><span class="RktVal">empty</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVal">'</span><span class="RktVal">null</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">or</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rx</span><span class="hspace">&nbsp;</span><span class="RktVar">rx</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">and</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rx</span><span class="hspace">&nbsp;</span><span class="RktVar">rx</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">not</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rx</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">seq</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rx</span><span class="hspace">&nbsp;</span><span class="RktVar">rx</span><span class="RktPn">)</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">*</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">rx</span><span class="RktPn">)</span></td></tr></table></p><ul><li><p><span class="RktSym">character</span> matches the character <span class="RktSym">character</span></p></li><li><p><span class="RktVal">'</span><span class="RktVal">empty</span> matches the empty string</p></li><li><p><span class="RktVal">'</span><span class="RktVal">null</span> doesn&rsquo;t match any strings</p></li><li><p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">or</span><span class="stt"> </span><span class="RktSym">a</span><span class="stt"> </span><span class="RktSym">b</span><span class="RktPn">)</span> matches strings that match <span class="RktSym">a</span> or <span class="RktSym">b</span></p></li><li><p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">and</span><span class="stt"> </span><span class="RktSym">a</span><span class="stt"> </span><span class="RktSym">b</span><span class="RktPn">)</span> matches strings that match <span class="RktSym">a</span> and <span class="RktSym">b</span>. This is a feature that most regular expression implementations do not support.</p></li><li><p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">not</span><span class="stt"> </span><span class="RktSym">a</span><span class="RktPn">)</span> matches strings that do not match <span class="RktSym">a</span>. This is a feature that most regular expression implementations do not support.</p></li><li><p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">seq</span><span class="stt"> </span><span class="RktSym">a</span><span class="stt"> </span><span class="RktSym">b</span><span class="RktPn">)</span> matches strings that can be partitioned into a substring that matches <span class="RktSym">a</span> followed by a substring that matches <span class="RktSym">b</span>.
This is the concatenation of two regular expressions.</p></li><li><p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">*</span><span class="stt"> </span><span class="RktSym">a</span><span class="RktPn">)</span> matches strings that match zero or more concatenations of <span class="RktSym">a</span> with itself</p></li></ul><p>First, we must define a helper function that determines whether a regular expression matches the empty string. If it does, we return <span class="RktVal">'</span><span class="RktVal">empty</span>. Otherwise, we return <span class="RktVal">'</span><span class="RktVal">null</span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">re</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/characters.html#%28def._%28%28quote._~23~25kernel%29._char~3f%29%29" class="RktValLink" data-pltdoc="x">char?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">seq</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Equality.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Equality.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">not</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Equality.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'empty</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'empty</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'empty</span></p></td></tr></table></blockquote><p>Now, we&rsquo;re ready to implement the derivative:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">re</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/characters.html#%28def._%28%28quote._~23~25kernel%29._char~3f%29%29" class="RktValLink" data-pltdoc="x">char?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c^</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Equality.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" class="RktValLink" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym">c^</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">not</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">not</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'empty</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(or (seq empty #\b) (seq null null))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\z</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(or (seq null #\b) (seq null null))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(or (or (seq empty #\b) (seq null null)) (or (seq empty #\c) (seq null null)))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\z</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(or (or (seq null #\b) (seq null null)) (or (seq null #\c) (seq null null)))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'(and (or (seq empty #\b) (seq null null))</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(or (seq empty #\c) (seq null null)))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\z</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(and (or (seq null #\b) (seq null null)) (or (seq null #\c) (seq null null)))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(seq empty (* #\a))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(seq (or (seq empty #\b) (seq null null)) (* (seq #\a #\b)))</span></p></td></tr></table></blockquote><p>For the character case, we check if the target character matches the regular expression character. If it does, then the only thing that can follow the target character in a string
is the empty string, so that&rsquo;s the derivative. If it doesn&rsquo;t, there are no strings that can follow the character, so we return null. Remember, the result of a derivative is a regular expression
that matches strings that, when appended after the target character, match the original regular expression. If the derivative is <span class="RktVal">'</span><span class="RktVal">null</span>, then the match failed because there are
no strings that can follow the character and produce a match. In other words, the target character is not the first character of any matches of the regular expression.</p><p>For the <span class="RktVal">'</span><span class="RktVal">empty</span> expression, we return <span class="RktVal">'</span><span class="RktVal">null</span> because the empty expression does not match a character. The empty expression only matches the empty string.</p><p>For the <span class="RktVal">'</span><span class="RktVal">null</span> expression, we return <span class="RktVal">'</span><span class="RktVal">null</span> because the null expression does not match any strings.</p><p>For star expressions, we concatenate the sub-expression&rsquo;s derivative with the star expression. Concatenating the original star expression gives us the repetition behavior.</p><p>For sequences, there are two cases. The intuitive case is the first one, <span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="stt"> </span><span class="RktSym">a</span><span class="stt"> </span><span class="RktSym">c</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span>. This is the derivative of the first regular expression concatenated with the second expression.
However, if the first regular expression matches the empty string, the derivative of the sequence could also be <span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="stt"> </span><span class="RktSym">b</span><span class="stt"> </span><span class="RktSym">c</span><span class="RktPn">)</span>. We implement this using our <span class="RktSym">v</span> helper and properties of regular expressions.</p><p>If <span class="RktPn">(</span><span class="RktSym">v</span><span class="stt"> </span><span class="RktSym">a</span><span class="RktPn">)</span> returns <span class="RktVal">'</span><span class="RktVal">empty</span>, the second case becomes <span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="stt"> </span><span class="RktVal">empty</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="stt"> </span><span class="RktSym">b</span><span class="stt"> </span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktVal">)</span>, which is equivalent to <span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="stt"> </span><span class="RktSym">b</span><span class="stt"> </span><span class="RktSym">c</span><span class="RktPn">)</span>.
If <span class="RktPn">(</span><span class="RktSym">v</span><span class="stt"> </span><span class="RktSym">a</span><span class="RktPn">)</span> is <span class="RktVal">'</span><span class="RktVal">null</span>, we get <span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="stt"> </span><span class="RktVal">null</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="stt"> </span><span class="RktSym">b</span><span class="stt"> </span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktVal">)</span>, which is equivalent to <span class="RktVal">'</span><span class="RktVal">null</span>. So we only ever "try" the derivative of <span class="RktSym">b</span>
when <span class="RktSym">a</span> matches the empty string.</p><p>We want the derivative to match all strings matched by either of these two cases, so we use <span class="RktVal">'</span><span class="RktVal">or</span>.</p><p>The other cases are just straightforward recursive cases, threading the derivative through the sub-expressions.</p><p>The  first two examples show the simple character cases. The following examples seem complicated, but if we use the properties of regular expressions, we can simplify the results.
For example, <span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="stt"> </span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="stt"> </span><span class="RktVal">#\a</span><span class="stt"> </span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span> evaluates to <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="stt"> </span><span class="RktVal">empty</span><span class="stt"> </span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="stt"> </span><span class="RktVal">null</span><span class="stt"> </span><span class="RktVal">null</span><span class="RktVal">)</span><span class="RktVal">)</span>, which is equivalent to <span class="RktVal">#\b</span>. Try to simplify the other outputs and make sure the results are what you expect.</p><h5>1.1<tt>&nbsp;</tt><a name="(part._.Detour__.A_.Simplifier)"></a>Detour: A Simplifier</h5><p>If you simplified those by hand, you&rsquo;d probably agree that this is a computer&rsquo;s job. So let&rsquo;s make a function to do it for us!
This will make it easier to analyze our derivatives and it&rsquo;s a fun exercise.</p><p>We&rsquo;ll start by writing the rewrite rules:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">re</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/characters.html#%28def._%28%28quote._~23~25kernel%29._char~3f%29%29" class="RktValLink" data-pltdoc="x">char?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">null</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">empty</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">null</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">null</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">empty</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">null</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">null</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/characters.html#%28def._%28%28quote._~23~25kernel%29._char~3f%29%29" class="RktValLink" data-pltdoc="x">char?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/characters.html#%28def._%28%28quote._~23~25kernel%29._char~3f%29%29" class="RktValLink" data-pltdoc="x">char?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Equality.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" class="RktValLink" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">null</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">null</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">not</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">not</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>These are some simple rewrite rules for simplifying regular expressions. For example, the rule <span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="stt"> </span><span class="RktVal">null</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">~&gt;</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">null</span> makes sense because a string has to match both <span class="RktVal">'</span><span class="RktVal">null</span> and some regular expression <span class="RktSym">b</span>
to match <span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="stt"> </span><span class="RktVal">null</span><span class="stt"> </span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span>, but it won&rsquo;t match <span class="RktVal">'</span><span class="RktVal">null</span>, so the whole thing is equivalent to <span class="RktVal">'</span><span class="RktVal">null</span>. Make sure all of the rules make sense to you.</p><p>Now we&rsquo;ll implement the recursive part:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step*</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">re^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Equality.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="hspace">&nbsp;</span><span class="RktSym">re^</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">re^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step*</span><span class="hspace">&nbsp;</span><span class="RktSym">re^</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">re</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._or%29%29" class="RktStxLink" data-pltdoc="x">or</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/characters.html#%28def._%28%28quote._~23~25kernel%29._char~3f%29%29" class="RktValLink" data-pltdoc="x">char?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step*</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step*</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step*</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step*</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">not</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">simplify-step*</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">not</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p><span class="RktSym">simplify-step*</span> repeatedly applies <span class="RktSym">simplify-step</span> until the result is unchanged.
This is guaranteed to terminate because our rewrite rules either produce a sub-expression, an atomic expression,
or the unchanged input expression. Atomic expressions are returned unchanged, so eventually, we&rsquo;ll either produce
an expression with no rewrite rule (gets returned unchanged) or an atomic and then terminate.</p><p><span class="RktSym">simplify</span> simplifies the expression bottom-up, simplifying sub-expressions first and then repeatedly
applying our rewrite rules on the input expression with simplified children.</p><p>This is by no means an exhaustive, rigorous simplifier, but it gets the job done for our purposes.</p><p>Finally, we can simplify those derivatives:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'empty</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#\b</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\z</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(or #\b #\c)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\z</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">and</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\z</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'null</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(* #\a)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(seq #\b (* (seq #\a #\b)))</span></p></td></tr></table></blockquote><p>Beautiful!</p><h4>2<tt>&nbsp;</tt><a name="(part._.Putting_it_.All_.Together)"></a>Putting it All Together</h4><p>Now that we can differentiate a regular expression with respect to a character, we can differentiate with respect to a string by
sequencing character derivatives.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Ffold%29%29" class="RktStxLink" data-pltdoc="x">for/fold</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">re</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-string%29%29" class="RktValLink" data-pltdoc="x">in-string</a></span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/dc</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"ab"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'empty</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"ab"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#\c</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">""</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(* #\a)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"a"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(* #\a)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"aaaaa"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(* #\a)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">""</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(* (seq #\a #\b))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"a"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(seq #\b (* (seq #\a #\b)))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"ab"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(* (seq #\a #\b))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">simplify</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"ababababa"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(seq #\b (* (seq #\a #\b)))</span></p></td></tr></table></blockquote><p>With this, we can finally determine if a string matches a regular expression:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">d/ds</span><span class="hspace">&nbsp;</span><span class="RktSym">re</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">'</span><span class="RktVal">empty</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">'</span><span class="RktVal">null</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">"a"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">"b"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"ab"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"az"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"abc"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"ab"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"ac"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">or</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\c</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"az"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">""</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"a"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"aaaaaaaaaa"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">""</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"a"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"ab"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"aba"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">our-regexp-match</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">seq</span><span class="hspace">&nbsp;</span><span class="RktVal">#\a</span><span class="hspace">&nbsp;</span><span class="RktVal">#\b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"abab"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote><p>This method is cool and simple, but does not generalize well to features like capture groups. Regardless,
I think it is a very interesting idea and a fun exercise.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="composable-promises.html" title="backward to &quot;Composable Promises: Adding Laziness to a Strict Language and Collapsing Indirection&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;QuasarBright Blog&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>